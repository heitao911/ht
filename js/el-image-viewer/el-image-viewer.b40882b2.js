import{d as e,aW as a,M as n,O as t,a3 as l,aH as o,n as s,bA as i,bB as r,bC as u,b3 as c,u as d,bD as v,k as f,bE as m,s as p,p as b,e as g,I as y,o as x,q as k,t as w,D as h,v as C,aa as I,A as z,x as L,z as A,B as O,G as _,E as N,b2 as S,y as E,Z as T,bi as B,a2 as $,bF as R,bG as j,ak as V,bH as Y,bI as P,au as X,X as M,Y as H,C as D,T as F,bJ as W,_ as q,J as G,l as K,bj as Z,H as J,bp as U,ac as Q,K as ee,ar as ae,a0 as ne,m as te,U as le,bK as oe,aj as se,ag as ie,P as re,r as ue,g as ce,f as de,a4 as ve,i as fe,bL as me}from"../index.7b49a549.js";import{d as pe}from"../debounce/debounce.8e1341c4.js";import{u as be}from"../index/index.9a655fd0.js";import{a as ge}from"../scroll/scroll.3a6c91c3.js";function ye(e,n,t){var l=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return a(t)&&(l="leading"in t?!!t.leading:l,o="trailing"in t?!!t.trailing:o),pe(e,n,{leading:l,maxWait:n,trailing:o})}const xe=n({urlList:{type:t(Array),default:()=>l([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),ke={close:()=>!0,switch:e=>o(e),rotate:e=>o(e)},we=["src"],he=s({name:"ElImageViewer"});const Ce=J(q(s({...he,props:xe,emits:ke,setup(e,{expose:a,emit:n}){const t=e,l={CONTAIN:{name:"contain",icon:i(r)},ORIGINAL:{name:"original",icon:i(u)}},{t:s}=c(),q=d("image-viewer"),{nextZIndex:J}=v(),U=f(),Q=f([]),ee=m(),ae=f(!0),ne=f(t.initialIndex),te=p(l.CONTAIN),le=f({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),oe=b((()=>{const{urlList:e}=t;return e.length<=1})),se=b((()=>0===ne.value)),ie=b((()=>ne.value===t.urlList.length-1)),re=b((()=>t.urlList[ne.value])),ue=b((()=>[q.e("btn"),q.e("prev"),q.is("disabled",!t.infinite&&se.value)])),ce=b((()=>[q.e("btn"),q.e("next"),q.is("disabled",!t.infinite&&ie.value)])),de=b((()=>{const{scale:e,deg:a,offsetX:n,offsetY:t,enableTransition:o}=le.value;let s=n/e,i=t/e;switch(a%360){case 90:case-270:[s,i]=[i,-s];break;case 180:case-180:[s,i]=[-s,-i];break;case 270:case-90:[s,i]=[-i,s]}const r={transform:`scale(${e}) rotate(${a}deg) translate(${s}px, ${i}px)`,transition:o?"transform .3s":""};return te.value.name===l.CONTAIN.name&&(r.maxWidth=r.maxHeight="100%"),r})),ve=b((()=>o(t.zIndex)?t.zIndex:J()));function fe(){ee.stop(),n("close")}function me(){ae.value=!1}function pe(e){ae.value=!1,e.target.alt=s("el.image.error")}function be(e){if(ae.value||0!==e.button||!U.value)return;le.value.enableTransition=!1;const{offsetX:a,offsetY:n}=le.value,t=e.pageX,l=e.pageY,o=ye((e=>{le.value={...le.value,offsetX:a+e.pageX-t,offsetY:n+e.pageY-l}})),s=K(document,"mousemove",o);K(document,"mouseup",(()=>{s()})),e.preventDefault()}function ge(){le.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function xe(){if(ae.value)return;const e=Z(l),a=Object.values(l),n=te.value.name,t=(a.findIndex((e=>e.name===n))+1)%e.length;te.value=l[e[t]],ge()}function ke(e){const a=t.urlList.length;ne.value=(e+a)%a}function he(){se.value&&!t.infinite||ke(ne.value-1)}function Ce(){ie.value&&!t.infinite||ke(ne.value+1)}function Ie(e,a={}){if(ae.value)return;const{minScale:l,maxScale:o}=t,{zoomRate:s,rotateDeg:i,enableTransition:r}={zoomRate:t.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":le.value.scale>l&&(le.value.scale=Number.parseFloat((le.value.scale/s).toFixed(3)));break;case"zoomIn":le.value.scale<o&&(le.value.scale=Number.parseFloat((le.value.scale*s).toFixed(3)));break;case"clockwise":le.value.deg+=i,n("rotate",le.value.deg);break;case"anticlockwise":le.value.deg-=i,n("rotate",le.value.deg)}le.value.enableTransition=r}return g(re,(()=>{y((()=>{const e=Q.value[0];(null==e?void 0:e.complete)||(ae.value=!0)}))})),g(ne,(e=>{ge(),n("switch",e)})),x((()=>{var e,a;!function(){const e=ye((e=>{switch(e.code){case G.esc:t.closeOnPressEscape&&fe();break;case G.space:xe();break;case G.left:he();break;case G.up:Ie("zoomIn");break;case G.right:Ce();break;case G.down:Ie("zoomOut")}})),a=ye((e=>{Ie((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:t.zoomRate,enableTransition:!1})}));ee.run((()=>{K(document,"keydown",e),K(document,"wheel",a)}))}(),null==(a=null==(e=U.value)?void 0:e.focus)||a.call(e)})),a({setActiveItem:ke}),(e,a)=>(k(),w(W,{to:"body",disabled:!e.teleported},[h(F,{name:"viewer-fade",appear:""},{default:C((()=>[I("div",{ref_key:"wrapper",ref:U,tabindex:-1,class:z(L(q).e("wrapper")),style:A({zIndex:L(ve)})},[I("div",{class:z(L(q).e("mask")),onClick:a[0]||(a[0]=O((a=>e.hideOnClickModal&&fe()),["self"]))},null,2),_(" CLOSE "),I("span",{class:z([L(q).e("btn"),L(q).e("close")]),onClick:fe},[h(L(N),null,{default:C((()=>[h(L(S))])),_:1})],2),_(" ARROW "),L(oe)?_("v-if",!0):(k(),E(T,{key:0},[I("span",{class:z(L(ue)),onClick:he},[h(L(N),null,{default:C((()=>[h(L(B))])),_:1})],2),I("span",{class:z(L(ce)),onClick:Ce},[h(L(N),null,{default:C((()=>[h(L($))])),_:1})],2)],64)),_(" ACTIONS "),I("div",{class:z([L(q).e("btn"),L(q).e("actions")])},[I("div",{class:z(L(q).e("actions__inner"))},[h(L(N),{onClick:a[1]||(a[1]=e=>Ie("zoomOut"))},{default:C((()=>[h(L(R))])),_:1}),h(L(N),{onClick:a[2]||(a[2]=e=>Ie("zoomIn"))},{default:C((()=>[h(L(j))])),_:1}),I("i",{class:z(L(q).e("actions__divider"))},null,2),h(L(N),{onClick:xe},{default:C((()=>[(k(),w(V(L(te).icon)))])),_:1}),I("i",{class:z(L(q).e("actions__divider"))},null,2),h(L(N),{onClick:a[3]||(a[3]=e=>Ie("anticlockwise"))},{default:C((()=>[h(L(Y))])),_:1}),h(L(N),{onClick:a[4]||(a[4]=e=>Ie("clockwise"))},{default:C((()=>[h(L(P))])),_:1})],2)],2),_(" CANVAS "),I("div",{class:z(L(q).e("canvas"))},[(k(!0),E(T,null,X(e.urlList,((e,a)=>M((k(),E("img",{ref_for:!0,ref:e=>Q.value[a]=e,key:e,src:e,style:A(L(de)),class:z(L(q).e("img")),onLoad:me,onError:pe,onMousedown:be},null,46,we)),[[H,a===ne.value]]))),128))],2),D(e.$slots,"default")],6)])),_:3})],8,["disabled"]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]])),Ie=n({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:t([String,Object])},previewSrcList:{type:t(Array),default:()=>l([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),ze={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>o(e),close:()=>!0,show:()=>!0},Le=["src","loading"],Ae={key:0},Oe=s({name:"ElImage",inheritAttrs:!1});const _e=J(q(s({...Oe,props:Ie,emits:ze,setup(a,{emit:n}){const t=a;let l="";const{t:o}=c(),s=d("image"),i=U(),r=be(),u=f(),v=f(!1),m=f(!0),p=f(!1),h=f(),O=f(),N=e&&"loading"in HTMLImageElement.prototype;let S,B;const $=b((()=>[s.e("inner"),V.value&&s.e("preview"),m.value&&s.is("loading")])),R=b((()=>i.style)),j=b((()=>{const{fit:a}=t;return e&&a?{objectFit:a}:{}})),V=b((()=>{const{previewSrcList:e}=t;return Array.isArray(e)&&e.length>0})),Y=b((()=>{const{previewSrcList:e,initialIndex:a}=t;let n=a;return a>e.length-1&&(n=0),n})),P=b((()=>"eager"!==t.loading&&(!N&&"lazy"===t.loading||t.lazy))),X=()=>{e&&(m.value=!0,v.value=!1,u.value=t.src)};function M(e){m.value=!1,v.value=!1,n("load",e)}function H(e){m.value=!1,v.value=!0,n("error",e)}function F(){((a,n)=>{if(!e||!a||!n)return!1;const t=a.getBoundingClientRect();let l;return l=n instanceof Element?n.getBoundingClientRect():{top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},t.top<l.bottom&&t.bottom>l.top&&t.right>l.left&&t.left<l.right})(h.value,O.value)&&(X(),G())}const W=te(F,200,!0);async function q(){var a;if(!e)return;await y();const{scrollContainer:n}=t;ae(n)?O.value=n:ne(n)&&""!==n?O.value=null!=(a=document.querySelector(n))?a:void 0:h.value&&(O.value=ge(h.value)),O.value&&(S=K(O,"scroll",W),setTimeout((()=>F()),100))}function G(){e&&O.value&&W&&(null==S||S(),O.value=void 0)}function Z(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}function J(){V.value&&(B=K("wheel",Z,{passive:!1}),l=document.body.style.overflow,document.body.style.overflow="hidden",p.value=!0,n("show"))}function le(){null==B||B(),document.body.style.overflow=l,p.value=!1,n("close")}function oe(e){n("switch",e)}return g((()=>t.src),(()=>{P.value?(m.value=!0,v.value=!1,G(),q()):X()})),x((()=>{P.value?q():X()})),(e,a)=>(k(),E("div",{ref_key:"container",ref:h,class:z([L(s).b(),e.$attrs.class]),style:A(L(R))},[v.value?D(e.$slots,"error",{key:0},(()=>[I("div",{class:z(L(s).e("error"))},Q(L(o)("el.image.error")),3)])):(k(),E(T,{key:1},[void 0!==u.value?(k(),E("img",ee({key:0},L(r),{src:u.value,loading:e.loading,style:L(j),class:L($),onClick:J,onLoad:M,onError:H}),null,16,Le)):_("v-if",!0),m.value?(k(),E("div",{key:1,class:z(L(s).e("wrapper"))},[D(e.$slots,"placeholder",{},(()=>[I("div",{class:z(L(s).e("placeholder"))},null,2)]))],2)):_("v-if",!0)],64)),L(V)?(k(),E(T,{key:2},[p.value?(k(),w(L(Ce),{key:0,"z-index":e.zIndex,"initial-index":L(Y),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:le,onSwitch:oe},{default:C((()=>[e.$slots.viewer?(k(),E("div",Ae,[D(e.$slots,"viewer")])):_("v-if",!0)])),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):_("v-if",!0)],64)):_("v-if",!0)],6))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]));function Ne(e){let a;const n=f(!1),t=le({...e,originalPosition:"",originalOverflow:"",visible:!1});function l(){var e,a;null==(a=null==(e=u.$el)?void 0:e.parentNode)||a.removeChild(u.$el)}function o(){if(!n.value)return;const e=t.parent;n.value=!1,e.vLoadingAddClassList=void 0,function(){const e=t.parent,a=u.ns;if(!e.vLoadingAddClassList){let n=e.getAttribute("loading-number");n=Number.parseInt(n)-1,n?e.setAttribute("loading-number",n.toString()):(ue(e,a.bm("parent","relative")),e.removeAttribute("loading-number")),ue(e,a.bm("parent","hidden"))}l(),r.unmount()}()}const i=s({name:"ElLoading",setup(e,{expose:a}){const{ns:n,zIndex:l}=ie("loading");return a({ns:n,zIndex:l}),()=>{const e=t.spinner||t.svg,a=re("svg",{class:"circular",viewBox:t.svgViewBox?t.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[re("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),l=t.text?re("p",{class:n.b("text")},[t.text]):void 0;return re(F,{name:n.b("fade"),onAfterLeave:o},{default:C((()=>[M(h("div",{style:{backgroundColor:t.background||""},class:[n.b("mask"),t.customClass,t.fullscreen?"is-fullscreen":""]},[re("div",{class:n.b("spinner")},[a,l])]),[[H,t.visible]])]))})}}}),r=oe(i),u=r.mount(document.createElement("div"));return{...se(t),setText:function(e){t.text=e},removeElLoadingChild:l,close:function(){var l;e.beforeClose&&!e.beforeClose()||(n.value=!0,clearTimeout(a),a=window.setTimeout(o,400),t.visible=!1,null==(l=e.closed)||l.call(e))},handleAfterLeave:o,vm:u,get $el(){return u.$el}}}let Se;const Ee=function(a={}){if(!e)return;const n=Te(a);if(n.fullscreen&&Se)return Se;const t=Ne({...n,closed:()=>{var e;null==(e=n.closed)||e.call(n),n.fullscreen&&(Se=void 0)}});Be(n,n.parent,t),$e(n,n.parent,t),n.parent.vLoadingAddClassList=()=>$e(n,n.parent,t);let l=n.parent.getAttribute("loading-number");return l=l?`${Number.parseInt(l)+1}`:"1",n.parent.setAttribute("loading-number",l),n.parent.appendChild(t.$el),y((()=>t.visible.value=n.visible)),n.fullscreen&&(Se=t),t},Te=e=>{var a,n,t,l;let o;return o=ne(e.target)?null!=(a=document.querySelector(e.target))?a:document.body:e.target||document.body,{parent:o===document.body||e.body?document.body:o,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:o===document.body&&(null==(n=e.fullscreen)||n),lock:null!=(t=e.lock)&&t,customClass:e.customClass||"",visible:null==(l=e.visible)||l,target:o}},Be=async(e,a,n)=>{const{nextZIndex:t}=n.vm.zIndex||n.vm._.exposed.zIndex,l={};if(e.fullscreen)n.originalPosition.value=ce(document.body,"position"),n.originalOverflow.value=ce(document.body,"overflow"),l.zIndex=t();else if(e.parent===document.body){n.originalPosition.value=ce(document.body,"position"),await y();for(const a of["top","left"]){const n="top"===a?"scrollTop":"scrollLeft";l[a]=e.target.getBoundingClientRect()[a]+document.body[n]+document.documentElement[n]-Number.parseInt(ce(document.body,`margin-${a}`),10)+"px"}for(const a of["height","width"])l[a]=`${e.target.getBoundingClientRect()[a]}px`}else n.originalPosition.value=ce(a,"position");for(const[o,s]of Object.entries(l))n.$el.style[o]=s},$e=(e,a,n)=>{const t=n.vm.ns||n.vm._.exposed.ns;["absolute","fixed","sticky"].includes(n.originalPosition.value)?ue(a,t.bm("parent","relative")):de(a,t.bm("parent","relative")),e.fullscreen&&e.lock?de(a,t.bm("parent","hidden")):ue(a,t.bm("parent","hidden"))},Re=Symbol("ElLoading"),je=(e,a)=>{var n,t,l,o;const s=a.instance,i=e=>ve(a.value)?a.value[e]:void 0,r=a=>(e=>{const a=ne(e)&&(null==s?void 0:s[e])||e;return a?f(a):a})(i(a)||e.getAttribute(`element-loading-${me(a)}`)),u=null!=(n=i("fullscreen"))?n:a.modifiers.fullscreen,c={text:r("text"),svg:r("svg"),svgViewBox:r("svgViewBox"),spinner:r("spinner"),background:r("background"),customClass:r("customClass"),fullscreen:u,target:null!=(t=i("target"))?t:u?void 0:e,body:null!=(l=i("body"))?l:a.modifiers.body,lock:null!=(o=i("lock"))?o:a.modifiers.lock};e[Re]={options:c,instance:Ee(c)}},Ve={mounted(e,a){a.value&&je(e,a)},updated(e,a){const n=e[Re];a.oldValue!==a.value&&(a.value&&!a.oldValue?je(e,a):a.value&&a.oldValue?ve(a.value)&&((e,a)=>{for(const n of Object.keys(a))fe(a[n])&&(a[n].value=e[n])})(a.value,n.options):null==n||n.instance.close())},unmounted(e){var a;null==(a=e[Re])||a.instance.close()}};export{_e as E,ye as t,Ve as v};
